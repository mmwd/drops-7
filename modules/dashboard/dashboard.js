(function(a){Drupal.behaviors.dashboard={attach:function(b,c){a("#dashboard",b).once(function(){a(this).prepend('<div class="customize clearfix"><ul class="action-links"><li><a href="#">'+Drupal.t("Customize dashboard")+'</a></li></ul><div class="canvas"></div></div>');a(".customize .action-links a",this).click(Drupal.behaviors.dashboard.enterCustomizeMode)});Drupal.behaviors.dashboard.addPlaceholders();if(Drupal.settings.dashboard.launchCustomize){Drupal.behaviors.dashboard.enterCustomizeMode()}},addPlaceholders:function(){a("#dashboard .dashboard-region .region").each(function(){var b="";if(a(".block",this).length==0){if(a("#dashboard").hasClass("customize-mode")){b=Drupal.settings.dashboard.emptyRegionTextActive}else{b=Drupal.settings.dashboard.emptyRegionTextInactive}if(a(".placeholder",this).length==0){a(this).append('<div class="placeholder"></div>')}a(".placeholder",this).html(b)}else{a(".placeholder",this).remove()}})},enterCustomizeMode:function(){a("#dashboard").addClass("customize-mode customize-inactive");Drupal.behaviors.dashboard.addPlaceholders();a("#dashboard .customize .action-links").hide();a("div.customize .canvas").load(Drupal.settings.dashboard.drawer,Drupal.behaviors.dashboard.setupDrawer)},exitCustomizeMode:function(){a("#dashboard").removeClass("customize-mode customize-inactive");Drupal.behaviors.dashboard.addPlaceholders();location.href=Drupal.settings.dashboard.dashboard},setupDrawer:function(){a("div.customize .canvas-content input").click(Drupal.behaviors.dashboard.exitCustomizeMode);a("div.customize .canvas-content").append('<a class="button" href="'+Drupal.settings.dashboard.dashboard+'">'+Drupal.t("Done")+"</a>");var b=a("#dashboard div.region");b.sortable({connectWith:b,cursor:"move",cursorAt:{top:0},dropOnEmpty:true,items:"> div.block, > div.disabled-block",placeholder:"block-placeholder clearfix",tolerance:"pointer",start:Drupal.behaviors.dashboard.start,over:Drupal.behaviors.dashboard.over,sort:Drupal.behaviors.dashboard.sort,update:Drupal.behaviors.dashboard.update})},start:function(c,d){a("#dashboard").removeClass("customize-inactive");var b=a(d.item);if(!b.hasClass("disabled-block")){b.css({height:"auto"})}},over:function(c,d){var b=a(d.item);if(a(this).closest("#disabled-blocks").length){b.css("width","")}else{b.css("width",a(this).width())}},sort:function(c,d){var b=a(d.item);if(c.pageX>d.offset.left+b.width()){b.css("left",c.pageX)}},update:function(d,e){a("#dashboard").addClass("customize-inactive");var c=a(e.item);if(c.hasClass("disabled-block")){var b,g,f;f=c.attr("class");b=f.match(/\bmodule-(\S+)\b/)[1];g=f.match(/\bdelta-(\S+)\b/)[1];a.get(Drupal.settings.dashboard.blockContent+"/"+b+"/"+g,{},function(h){if(h){c.html(h)}if(c.find("div.content").is(":empty")){c.find("div.content").html(Drupal.settings.dashboard.emptyBlockText)}Drupal.attachBehaviors(c)},"html");c.removeClass("disabled-block")}Drupal.behaviors.dashboard.addPlaceholders();a.post(Drupal.settings.dashboard.updatePath,{form_token:Drupal.settings.dashboard.formToken,regions:Drupal.behaviors.dashboard.getOrder})},getOrder:function(){var b=[];a("#dashboard div.region").each(function(){var c=a(this).parent().attr("id").replace(/-/g,"_");var d=a(this).sortable("toArray");a.each(d,function(){b.push(c+"[]="+this)})});b=b.join("&");return b}}})(jQuery);