(function(a){Drupal.behaviors.color={attach:function(g,y){var v,u,n,b;var f=a("#system-theme-settings .color-form",g).once("color");if(f.length==0){return}var h=[];var c=[];var A=[];var m=null;a(f).prepend('<div id="placeholder"></div>').addClass("color-processed");var o=a.farbtastic("#placeholder");var l=y.color.reference;for(v in l){l[v]=o.RGBToHSL(o.unpack(l[v]))}var q=[];var t=[];for(v in y.gradients){a("#preview").once("color").append('<div id="gradient-'+v+'"></div>');var d=a("#preview #gradient-"+v);q.push(parseInt(d.css("height"),10)/10);t.push(parseInt(d.css("width"),10)/10);for(u=0;u<(y.gradients[v]["direction"]=="vertical"?q[v]:t[v]);++u){d.append('<div class="gradient-line"></div>')}}if(navigator.appVersion.match(/MSIE [0-6]\./)){var x=a("#preview #img")[0];var p=x.currentStyle.backgroundImage;x.style.backgroundImage="none";x.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+p.substring(5,p.length-2)+"')"}a("#edit-scheme",f).change(function(){var i=y.color.schemes,e=this.options[this.selectedIndex].value;if(e!=""&&i[e]){n=i[e];for(b in n){k(a("#edit-palette-"+b),n[b],false,true)}s()}});function s(){Drupal.color.callback(g,y,f,o,q,t)}function w(B,i,e){B=o.RGBToHSL(o.unpack(B));B[0]+=e[0]-i[0];if(i[1]==0||e[1]==0){B[1]=e[1]}else{var j=i[1]/e[1];if(j>1){B[1]/=j}else{B[1]=1-(1-B[1])*j}}if(i[2]==0||e[2]==0){B[2]=e[2]}else{var j=i[2]/e[2];if(j>1){B[2]/=j}else{B[2]=1-(1-B[2])*j}}return o.pack(o.HSLToRGB(B))}function k(C,B,j,i){var e;a(C).css({backgroundColor:B,color:o.RGBToHSL(o.unpack(B))[2]>0.5?"#000":"#fff"});if(a(C).val()&&a(C).val()!=B){a(C).val(B);if(j){v=C.i;for(u=v+1;;++u){if(!A[u-1]||a(A[u-1]).is(".unlocked")){break}e=w(B,l[C.key],l[h[u].key]);k(h[u],e,false)}for(u=v-1;;--u){if(!A[u]||a(A[u]).is(".unlocked")){break}e=w(B,l[C.key],l[h[u].key]);k(h[u],e,false)}s()}if(!i){z()}}}function z(){a("#edit-scheme",f).each(function(){this.selectedIndex=this.options.length-1})}function r(){var e=this;m&&a(m).unbind("keyup",o.updateValue).unbind("keyup",s).unbind("keyup",z).parent().removeClass("item-selected");m=this;o.linkTo(function(i){k(e,i,true,false)});o.setColor(this.value);a(m).keyup(o.updateValue).keyup(s).keyup(z).parent().addClass("item-selected")}a("#palette input.form-text",f).each(function(){this.key=this.id.substring(13);o.linkTo(function(){}).setColor("#000").linkTo(this);var j=h.length;if(h.length){var e=a('<div class="lock"></div>').toggle(function(){a(this).addClass("unlocked");a(c[j-1]).attr("class",A[j-2]&&a(A[j-2]).is(":not(.unlocked)")?"hook up":"hook");a(c[j]).attr("class",A[j]&&a(A[j]).is(":not(.unlocked)")?"hook down":"hook")},function(){a(this).removeClass("unlocked");a(c[j-1]).attr("class",A[j-2]&&a(A[j-2]).is(":not(.unlocked)")?"hook both":"hook down");a(c[j]).attr("class",A[j]&&a(A[j]).is(":not(.unlocked)")?"hook both":"hook up")});a(this).after(e);A.push(e)}var B=a('<div class="hook"></div>');a(this).after(B);c.push(B);a(this).parent().find(".lock").click();this.i=j;h.push(this)}).focus(r);a("#palette label",f);r.call(h[0]);s()}}})(jQuery);